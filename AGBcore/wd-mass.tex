% !TEX TS-program = xelatex
\documentclass[11pt]{article}
\usepackage[
        pdfencoding=auto,%
        pdftitle={Notes on Stellar Astrophysics: Example Problems},%
        pdfauthor={Edward F. Brown},%
        pdfstartview=FitV,%
        colorlinks=true,%
        linkcolor=blue,%
        citecolor=black, %
        urlcolor=blue]{hyperref}
\usepackage{amssymb}
\usepackage{fontspec}
\usepackage{textcomp}
\usepackage{graphicx}
\usepackage{natbib}
\usepackage{fancyvrb}
\usepackage{aasjournals}

\defaultfontfeatures{Scale=MatchLowercase}
\setmainfont[Mapping=tex-text]{Minion Pro}
\setmonofont[Mapping=tex-text]{Courier}
\setsansfont[Mapping=tex-text]{Myriad Pro}

\include{units}
\include{vectors}
\include{nuclides}
\include{symbols}

\bibpunct{(}{)}{;}{a}{}{,}

\newcommand{\gsun}{\ensuremath{g_{\odot}}}
\newcommand{\tsix}{\ensuremath{t_{6}}}
\newcommand{\Teffsun}{\ensuremath{T_{\mathrm{eff,\odot}}}}
\newcommand{\mwd}{\ensuremath{m_{\mathrm{WD}}}}

\begin{document}
\newcommand{\thetitle}{AGB mass loss and the white dwarf mass distribution}
\newcommand{\thecourse}{AST 840}
\newcommand{\theauthor}{Edward F. Brown}

\begin{titlepage}
\begin{center}
\LARGE{\textbf{\thetitle}}\\*[1.5em]
\Large{\thecourse}\\*[2.5em]
\large{\theauthor}
\end{center}
\end{titlepage}

We start with the following equations,
\begin{eqnarray}\label{e.paczynski}
\frac{L}{\Lsun} &=& 5.9\ee{4}\left(\frac{M_{c}}{\Msun}-0.52\right)\\
\frac{\dif M_{c}}{\dif t} &=& \frac{L}{q}.\label{e.dmc}
\end{eqnarray}
For \hydrogen\ fusing to \helium\ the heat released per nucleon is $6.68\nsp\MeV/\amu = 6.44\ee{18}\nsp\ergs\usp\gram^{-1}$. It's convenient to scale these quantities to more useful units, so let's divide equation~(\ref{e.dmc}) by \Msun, and multiply the right-hand side by $\Lsun/\Lsun$; further, define $m_{c}\equiv M_{c}/\Msun$ and scale $t\to (10^{6}\nsp\yr)\cdot\tsix$.  Then we can substitute $L$ from equation~(\ref{e.paczynski}) into equation~(\ref{e.dmc}) to obtain
\begin{eqnarray}
\frac{\dif m_{c}}{\dif\tsix} &=& \frac{5.9\ee{4}\Lsun\cdot (10^{6}\nsp\yr)}{6.44\ee{18}\nsp\ergs\usp\gram^{-1}\cdot\Msun} \left(m_{c}-0.52\right) \nonumber\\
 &=& 0.57\left(m_{c}-0.52\right).\label{e.de-mass}
\end{eqnarray}
This equation is readily solved with an integrating factor, or we can just change variables to $\Delta\equiv m_{c}-0.52$ to obtain
\begin{equation}
m_{c}(\tsix) = 0.52 + \left(m_{c,0}-0.52\right)\exp(0.57\tsix).
\end{equation}
Here $m_{c,0} > 0.52$ is the initial core mass at the start of the AGB phase. The characteristic timescale in the problem is $(10^{6}\nsp\yr )\cdot(0.57)^{-1} = 1.8\nsp\Mega\yr$.

While this is going on, the high luminosity and low gravity in the envelope conspire to produce a strong wind; the star loses mass at a rate
\begin{equation}\label{e.mass-loss}
\frac{\dif M}{\dif t} = -8.0\ee{-13}\nsp\Msun\usp\yr^{-1}\left(\frac{L}{\Lsun}\frac{\gsun}{g}\frac{\Rsun}{R}\right).
\end{equation}
To make this tractable, we will assume a fixed $\Teff = 4000\nsp\K$.  Then we can write
\begin{equation}\label{e.r-l}
\left(\frac{L}{\Lsun}\frac{\gsun}{g}\frac{\Rsun}{R}\right) = \left(\frac{L}{\Lsun}\right)^{3/2}\left(\frac{\Msun}{M}\right)\left(\frac{\Teffsun}{\Teff}\right)^{2}.
\end{equation}
Defining $m \equiv M/\Msun$, changing variables $t\to\tsix$,  taking $\Teffsun/\Teff = (5780\nsp\K)/(4000\nsp\K)$, and using equation~(\ref{e.paczynski}) to eliminate $L/\Lsun$ then gives
\begin{equation}\label{e.m-deq}
m\frac{\dif m}{\dif \tsix} = -23.9(m_{c}-0.52)^{3/2}
\end{equation}
At this point, we can just integrate this equation. Since we are after a relation between $m$ and $m_{c}$, however, I am going to change the dependent variable from $\tsix$ to $\Delta = m_{c}-0.52$.  From equation~(\ref{e.de-mass}) we have $\dif\Delta/\dif\tsix = 0.57\Delta$; using this relation and writing $\dif m/\dif\tsix = (\dif m/\dif\Delta)(\dif \Delta/\dif\tsix)$, we can rewrite equation~(\ref{e.m-deq}) as
\begin{equation}\label{e.m-deq2}
m\frac{\dif m}{\dif\Delta} = -\frac{23.9}{0.57}\Delta^{1/2}. 
\end{equation}
This is readily integrated to give
\begin{eqnarray}
m^{2} &=& m_{0}^{2} - 56.0\left(\Delta^{3/2} - \Delta_{0}^{3/2}\right)\nonumber\\
 &=& m_{0}^{2} - 56.0\left[\left(m_{c}-0.52\right)^{3/2} - \left(m_{c,0}-0.52\right)^{3/2}\right].
\label{e.m-mc}
\end{eqnarray}
This equation gives the stellar mass as a function of time for an assumed initial core mass and an initial stellar mass.

At the end of the AGB phase, $m = m_{c}$, and we have an algebraic relation between the white dwarf mass $\mwd$, the core mass at the end of \helium\ burning $m_{c,0}$, and the total stellar mass at the end of the horizontal branch phase $m_{0}$,
\begin{equation}\label{e.mwd}
\mwd^{2} - m_{0}^{2} + 56.0\left[\left(\mwd-0.52\right)^{3/2} - \left(m_{c,0}-0.52\right)^{3/2}\right] = 0.
\end{equation}
It is easiest to find the root \mwd\ numerically. The simplest method is \emph{bisection}.  Pick two guesses for $\mwd$ that bracket the root; that is, one guess makes the LHS of equation~(\ref{e.mwd}) negative and the other makes the LHS positive.  Compute the midpoint of these two guesses.  Now find in which interval the root lies.  This defines a new bracket that is half the size of the initial bracket. By repeating this process, the bracket for the root can be made successively smaller until a desired tolerance is reached.  Figure~\ref{f.core-mass} shows the results for the final core mass: the left-hand panel holds $m_{0} = 2.0$ fixed and varies $m_{c,0}$, while the right-hand panel holds $m_{c,0} = 0.55$ fixed and varies $m_{0}$.

\begin{figure}[htbp]
\includegraphics[width=5in]{plots_out/core_mass_combined}
\caption{Final core mass as a function of the initial core mass $M_{c,0}$ (\emph{left}) for  a fixed initial stellar mass $M_{0} = 2.0\nsp\Msun$, and as a function of the initial stellar mass $M_{0}$ (\emph{right}) for a fixed $M_{c,0}=0.55\nsp\Msun$.\label{f.core-mass}}
\end{figure}
\clearpage

Here is the code used to implement the solution.  The module \verb|agb_end| holds the parameters of the equation and the function for equation~(\ref{e.mwd}); the program \verb|wd_mass| uses this module and \verb|bisect.f| to find the roots for a trial $m_{0}$, $m_{c,0}$, and coefficient (which is 56.0 in eq.~[\ref{e.mwd}]).
\VerbatimInput[numbers=left,numberblanklines=false]{agb.f}

The code to implement the bisection algorithm is
\VerbatimInput[numbers=left,numberblanklines=false]{rootfind.f}

The driver program to make the figure is then
\VerbatimInput[numbers=left,numberblanklines=false]{wdmass.f}

These codes were complied with \verb|gfortran| using the following options:
\begin{quote}
\verb|-ffree-form -fimplicit-none -fdefault-real-8|
\end{quote}

\end{document}